# Визуализатор расписания из Excel-файла в PDF

Этот проект представляет собой набор Python-скриптов для создания компактной визуализации расписания в формате PDF на основе данных из Excel-файла.

## Обновления

Последние улучшения:
- **Разделение длинных дней на подстолбцы**: Дни с большим количеством занятий (превышающим 2 страницы) автоматически разделяются на подстолбцы для более компактного отображения.
- **Фиксированная высота блоков**: Все блоки уроков имеют фиксированную высоту 60 пикселей.
- **Более толстые границы блоков**: Толщина границ блоков увеличена до 4 пикселей.
- **Многостраничный режим**: Расписание автоматически разбивается на страницы с повторением заголовков.

## Описание проекта

Визуализатор расписания позволяет:
- Загружать расписание из Excel-файла определенной структуры
- Создавать компактное представление расписания в формате PDF
- Экспортировать расписание в форматы HTML, PNG и ICS (календарь)
- Настраивать визуальное оформление с помощью конфигурационного файла

### Особенности визуализации
- Блоки занятий группируются по дням недели в квазитабличную структуру
- По горизонтали располагаются дни недели, по вертикали — хронологически упорядоченные блоки занятий
- Отсутствие пустот — отображаются только временные отрезки, когда проходят занятия
- Дни с большим количеством занятий делятся на подстолбцы для компактности
- Блоки имеют различные цвета в зависимости от типа группы и здания
- Информативное содержимое блоков: группа, преподаватель, аудитория, здание, время

## Требования

Для работы скрипта необходимы следующие библиотеки Python:
```
pandas
numpy
reportlab
openpyxl
```

Для экспорта в дополнительные форматы также могут потребоваться:
```
pdf2image  # для экспорта в PNG
poppler    # внешняя зависимость для pdf2image
icalendar  # для экспорта в формат календаря ICS
pytz       # для корректной работы с часовыми поясами в календаре
```

## Установка

1. Установите Python 3.7 или выше
2. Установите необходимые зависимости:
   ```
   pip install pandas numpy reportlab openpyxl
   ```
3. Для расширенных функций экспорта установите дополнительные библиотеки:
   ```
   pip install pdf2image icalendar pytz
   ```
4. Скачайте исходный код визуализатора

## Структура проекта

```
├── schedule_visualizer_main.py  # Основной файл с функцией main()
├── data_processor.py            # Модуль обработки данных расписания
├── color_manager.py             # Модуль управления цветами блоков
├── layout_manager.py            # Модуль компоновки расписания
├── config_manager.py            # Модуль управления настройками визуализации
├── export_manager.py            # Модуль экспорта расписания в различные форматы
├── example_usage.py             # Пример использования визуализатора
├── test_specific_example.py     # Тестирование с конкретным примером данных
├── test_subcolumns.py           # Тестирование разделения на подстолбцы
├── schedule_config.json         # Пример конфигурационного файла (опционально)
└── README.md                    # Этот файл с инструкциями
```

## Использование

### Простой пример

```python
from schedule_visualizer_main import main

# Путь к Excel-файлу с расписанием
excel_file = "optimized_schedule.xlsx"

# Путь для сохранения PDF-файла
pdf_file = "schedule_visualization.pdf"

# Генерируем визуализацию расписания
main(excel_file, pdf_file)
```

### Запуск с помощью example_usage.py

Просто запустите скрипт `example_usage.py`, убедившись, что в текущей директории есть файл `optimized_schedule.xlsx`:

```
python example_usage.py
```

### Тестирование разделения на подстолбцы

Если хотите увидеть, как работает функционал разделения дней с большим количеством занятий на подстолбцы, запустите:

```
python test_subcolumns.py
```

Этот скрипт создаст файл `subcolumns_test_schedule.xlsx` с большим количеством занятий в субботу и сгенерирует визуализацию в PDF и HTML форматах, демонстрирующую разделение на подстолбцы.

## Структура Excel-файла

Скрипт ожидает, что Excel-файл будет иметь следующую структуру:

### 1. Лист `Schedule` — основное расписание
Каждая строка на этом листе представляет собой одно занятие со следующими данными:
* **Столбец A — **`subject` Название предмета (например: Math, Deutsch, Russisch)
* **Столбец B — **`group` Название группы или подгруппы (например: 22-MATH, Deutsch 3kl Mo)
* **Столбец C — **`teacher` Имя и фамилия преподавателя (например: Olekh Katerina)
* **Столбец D — **`room` Номер или название аудитории (например: V2.03)
* **Столбец E — **`building` Название здания или филиала (например: Villa)
* **Столбец F — **`day` День недели (например: Mo, Di, Mi и т.д.)
* **Столбец G — **`start_time` Время начала занятия в формате ЧЧ:ММ (например: 14:30)
* **Столбец H — **`end_time` Время окончания занятия в формате ЧЧ:ММ (например: 15:30)
* **Столбец I — **`duration` Длительность занятия в минутах (например: 60, 90)
* **Столбец J — **`pause_before` Величина паузы до начала занятия (в минутах)
* **Столбец K — **`pause_after` Величина паузы после окончания занятия (в минутах)

### 2. Листы `T_<Имя>` — индивидуальные расписания преподавателей
* Например: `T_Olekh Katerina`
* Содержит только занятия, где `teacher` соответствует имени преподавателя
* Структура столбцов такая же, как на листе `Schedule` (A–K)

### 3. Листы `G_<Группа>` — индивидуальные расписания групп
* Например: `G_Deutsch 3kl Mo`
* Содержит только занятия для указанной группы
* Структура столбцов также соответствует листу `Schedule` (A–K)

## Примечания

- Высота блоков занятий фиксирована и составляет 60 пикселей
- Толщина границ блоков: 4 пикселя
- Цвет заливки блока определяется первым словом в названии группы
- Группы с названиями вида "цифра+буква" (например, "1A", "3D", "12E") имеют одинаковый цвет заливки
- Цвет контура блока определяется названием здания (building)
- Дни с количеством занятий, превышающим 2 страницы, автоматически разделяются на подстолбцы для более компактного отображения
